<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>CanterPro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f6f8;
    }

    .screen {
      padding: 16px;
    }

    .hidden {
      display: none;
    }

    .btn {
      padding: 16px;
      border-radius: 16px;
      border: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
    }

    .btn-primary {
      background: #1976d2;
      color: white;
    }

    .btn-danger {
      background: #d32f2f;
      color: white;
    }

    .btn-success {
      background: #388e3c;
      color: white;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    input {
      width: 100%;
      padding: 14px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #ccc;
      margin-top: 8px;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 12px;
      font-weight: bold;
      cursor: pointer;
    }

    .tab.active {
      background: #1976d2;
      color: white;
    }

    .tab.inactive {
      background: #e0e0e0;
    }

    .timer {
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      margin: 16px 0;
    }

    .report {
      white-space: pre-line;
      font-size: 16px;
    }
  </style>
</head>

<body>

<!-- –≠–ö–†–ê–ù –°–¢–ê–†–¢–ê -->
<div id="startScreen" class="screen">
  <div class="card">
    <h2>–î–æ–±—Ä–æ–µ —É—Ç—Ä–æ üëã</h2>
    <button class="btn btn-primary" onclick="startShift()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</button>
  </div>

  <div class="card">
    <button class="btn" onclick="openAnalytics()">–†–∞–±–æ—Ç–∞ —Å –æ—Ç—á–µ—Ç–∞–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π</button>
  </div>
</div>

<!-- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
<div id="mainScreen" class="screen hidden">

  <div class="tabs">
    <div class="tab active">–ó–∞–∫–∞–∑—ã</div>
    <div class="tab inactive">–†–∞–±–æ—á–∏–π –¥–µ–Ω—å</div>
    <div class="tab inactive">–†–∞—Å—Ö–æ–¥—ã</div>
  </div>

  <!-- –ë–õ–û–ö –ó–ê–ö–ê–ó–ê -->
  <div id="orderCard" class="card">

    <div id="orderSetup">
      <h3>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ (5+1)</h3>
      <label>–°—Ç–∞–≤–∫–∞ ‚ÇΩ/—á–∞—Å</label>
      <input id="rateInput" type="number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä 1000">
      <button class="btn btn-success" style="margin-top:16px" onclick="startOrder()">–ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <div id="orderActive" class="hidden">
      <div class="timer" id="timer">00:00:00</div>
      <button class="btn btn-danger" onclick="finishOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <div id="orderReport" class="hidden">
      <h3>–û—Ç—á–µ—Ç –ø–æ –∑–∞–∫–∞–∑—É</h3>
      <div id="reportText" class="report"></div>
      <button class="btn btn-primary" onclick="shareReport()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
    </div>

  </div>
</div>

<script>
let timerInterval = null;

function startShift() {
  const shift = {
    startTime: Date.now(),
    date: new Date().toISOString().slice(0,10),
    orders: [],
    status: "open"
  };
  localStorage.setItem("currentShift", JSON.stringify(shift));
  showMain();
}

function showMain() {
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("mainScreen").classList.remove("hidden");
}

function startOrder() {
  const rate = Number(document.getElementById("rateInput").value);
  if (!rate) {
    alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É");
    return;
  }

  const order = {
    rate,
    startTime: Date.now()
  };

  localStorage.setItem("currentOrder", JSON.stringify(order));

  document.getElementById("orderSetup").classList.add("hidden");
  document.getElementById("orderActive").classList.remove("hidden");

  startTimer();
}

function startTimer() {
  const start = JSON.parse(localStorage.getItem("currentOrder")).startTime;
  timerInterval = setInterval(() => {
    const diff = Date.now() - start;
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    const s = Math.floor((diff % 60000) / 1000);
    document.getElementById("timer").innerText =
      `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
  }, 1000);
}

function finishOrder() {
  clearInterval(timerInterval);

  const order = JSON.parse(localStorage.getItem("currentOrder"));
  order.endTime = Date.now();

  const totalMs = order.endTime - order.startTime;
  let hours = totalMs / 3600000;

  let roundedHours = Math.floor(hours);
  if ((hours - roundedHours) * 60 > 15) {
    roundedHours++;
  }

  const paidHours = Math.max(6, roundedHours);
  const total = paidHours * order.rate;

  order.total = total;
  order.paidHours = paidHours;

  const shift = JSON.parse(localStorage.getItem("currentShift"));
  shift.orders.push(order);
  localStorage.setItem("currentShift", JSON.stringify(shift));
  localStorage.removeItem("currentOrder");

  document.getElementById("orderActive").classList.add("hidden");
  document.getElementById("orderReport").classList.remove("hidden");

  document.getElementById("reportText").innerText =
`–ó–∞–∫–∞–∑ 5+1
–°—Ç–∞–≤–∫–∞: ${order.rate} ‚ÇΩ/—á–∞—Å
–§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è: ${hours.toFixed(2)} —á
–ö –æ–ø–ª–∞—Ç–µ –∑–∞: ${paidHours} —á
–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${total} ‚ÇΩ`;
}

function shareReport() {
  const text = document.getElementById("reportText").innerText;
  navigator.share({
    text
  });
}

function openAnalytics() {
  alert("–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ");
}

window.onload = () => {
  const shift = localStorage.getItem("currentShift");
  if (shift) {
    showMain();
  }
};
</script>

</body>
</html>
