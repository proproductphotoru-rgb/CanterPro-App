<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">

<!-- –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢ -->
<meta name="viewport"
  content="width=device-width, initial-scale=1.0,
           maximum-scale=1.0, user-scalable=no">

<title>CanterPro Ultra</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  overflow: hidden; /* üîë */
}

.app {
  height: 100%;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

.screen {
  display: none;
  padding: 16px;
  min-height: 100%;
  box-sizing: border-box;
}

.screen.active {
  display: block;
}

.card {
  background: #fff;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 16px;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 12px;
  border: none;
  border-radius: 8px;
  background: #1976d2;
  color: #fff;
}

button.red { background: #c62828; }
button.gray { background: #555; }

input, textarea, select {
  width: 100%;
  padding: 14px;
  font-size: 18px;
  margin-top: 8px;
  box-sizing: border-box;
}

.timer {
  font-size: 32px;
  text-align: center;
  margin-top: 8px;
}

pre {
  background: #eee;
  padding: 12px;
  white-space: pre-wrap;
}

.hidden { display: none; }
</style>
</head>

<body>
<div class="app">

<!-- –î–ï–ù–¨ -->
<div id="screen-day" class="screen active">
  <h1>CanterPro Ultra</h1>
  <div class="card">
    <button onclick="show('screen-settings')">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>
  <div class="card">
    <button onclick="startDay()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</button>
    <p id="dayInfo"></p>
  </div>
</div>

<!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
<div id="screen-settings" class="screen">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  <div class="card">
    <label>–†–µ–∫–≤–∏–∑–∏—Ç—ã</label>
    <textarea id="payDetails" rows="4"></textarea>

    <label>–£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏</label>
    <select id="timeMultiplier">
      <option value="1">–†–µ–∞–ª—å–Ω–æ</option>
      <option value="10">x10</option>
      <option value="30">x30</option>
      <option value="60">x60</option>
    </select>

    <button onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="gray" onclick="show('screen-day')">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- –í–´–ë–û–† -->
<div id="screen-type" class="screen">
  <h2>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
  <div class="card">
    <button onclick="openOrder()">–°—Ö–µ–º–∞ 5+1</button>
  </div>
</div>

<!-- –ó–ê–ö–ê–ó -->
<div id="screen-order" class="screen">
  <h2>–ó–∞–∫–∞–∑ ‚Ä¢ 5+1</h2>

  <!-- –í–í–û–î –°–¢–ê–í–ö–ò -->
  <div id="startBlock" class="card">
    <label>–°—Ç–∞–≤–∫–∞ ‚ÇΩ / —á–∞—Å</label>
    <input id="rate" type="number" inputmode="numeric">
    <button onclick="startOrder()">‚ñ∂ –ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <!-- –¢–ê–ô–ú–ï–† -->
  <div id="timerBlock" class="card hidden">
    <div id="timer" class="timer">00:00:00</div>
    <button class="red" onclick="finishOrder()">‚èπ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <!-- –ú–ê–†–®–†–£–¢ -->
  <div id="routeBlock" class="card hidden">
    <h3>–ú–∞—Ä—à—Ä—É—Ç</h3>
    <button onclick="openNavigator()">üó∫ –û—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å –ù–∞–≤–∏–≥–∞—Ç–æ—Ä</button>
    <label>–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂ (–∫–º)</label>
    <input id="distance" type="number" inputmode="decimal">
  </div>

  <!-- –û–¢–ß–Å–¢ -->
  <div id="resultBlock" class="card hidden">
    <pre id="report"></pre>
    <input id="photos" type="file" accept="image/*" multiple>
    <button class="gray" onclick="shareReport()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
    <button onclick="newOrder()">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
  </div>
</div>

</div>

<script>
let multiplier = Number(localStorage.getItem('multiplier') || 1);
let realStart = null, interval = null, lastReport = '';

payDetails.value = localStorage.getItem('payDetails') || '';
timeMultiplier.value = multiplier;

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function saveSettings() {
  multiplier = Number(timeMultiplier.value);
  localStorage.setItem('multiplier', multiplier);
  localStorage.setItem('payDetails', payDetails.value);
  alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
  show('screen-day');
}

function startDay() {
  dayInfo.textContent = '–ù–∞—á–∞—Ç–æ: ' + new Date().toLocaleTimeString();
  show('screen-type');
}

function openOrder() { show('screen-order'); }

function startOrder() {
  if (!rate.value) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É');

  // üîë –°–ë–†–û–° –§–û–ö–£–°–ê ‚Äî –ö–õ–ê–í–ò–ê–¢–£–†–ê –£–•–û–î–ò–¢
  rate.blur();

  startBlock.classList.add('hidden');
  timerBlock.classList.remove('hidden');
  routeBlock.classList.remove('hidden');

  realStart = Date.now();
  interval = setInterval(updateTimer, 1000);
}

function updateTimer() {
  const diff = (Date.now() - realStart) * multiplier;
  const s = Math.floor(diff / 1000);
  timer.textContent =
    String(Math.floor(s / 3600)).padStart(2, '0') + ':' +
    String(Math.floor(s % 3600 / 60)).padStart(2, '0') + ':' +
    String(s % 60).padStart(2, '0');
}

function openNavigator() {
  location.href = "yandexnavi://build_route_on_map";
}

function finishOrder() {
  clearInterval(interval);

  const end = new Date();
  const mins = Math.ceil((end - realStart) * multiplier / 60000);

  let paid = 6, round = '';
  if (mins > 360) {
    const ex = mins - 360;
    let eh = Math.floor(ex / 60);
    if (ex % 60 > 15) eh++;
    paid += eh;
    if (ex % 60 > 15)
      round = ` (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ ${String(end.getHours() + 1).padStart(2, '0')}:00)`;
  }

  lastReport =
`–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${end.toLocaleTimeString().slice(0,5)}${round}
–ö –æ–ø–ª–∞—Ç–µ –∑–∞: ${paid} —á
–°—Ç–∞–≤–∫–∞: ${rate.value} ‚ÇΩ/—á
–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${paid * rate.value} ‚ÇΩ
–ö–º –º–∞—Ä—à—Ä—É—Ç–∞: ${distance.value || '‚Äî'}

–†–µ–∫–≤–∏–∑–∏—Ç—ã:
${localStorage.getItem('payDetails') || '‚Äî'}`;

  report.textContent = lastReport;
  resultBlock.classList.remove('hidden');
}

async function shareReport() {
  await navigator.share({
    text: lastReport,
    files: [...photos.files]
  });
}

function newOrder() {
  startBlock.classList.remove('hidden');
  timerBlock.classList.add('hidden');
  routeBlock.classList.add('hidden');
  resultBlock.classList.add('hidden');

  rate.value = '';
  distance.value = '';
  photos.value = '';

  show('screen-type');
}
</script>

</body>
  </html>
