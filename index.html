<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CanterPro Ultra</title>

<style>
body { margin:0;font-family:Arial;background:#f2f2f2; }
.screen { display:none;padding:16px; }
.screen.active { display:block; }
.card { background:#fff;padding:16px;border-radius:8px;margin-bottom:16px; }
button { width:100%;padding:14px;font-size:16px;margin-top:12px;border:none;border-radius:6px;background:#1976d2;color:#fff; }
button.red{background:#c62828;} button.gray{background:#555;}
input,textarea,select{width:100%;padding:12px;font-size:16px;margin-top:8px;}
.timer{font-size:28px;text-align:center;margin-top:12px;}
pre{background:#eee;padding:12px;white-space:pre-wrap;}
</style>
</head>

<body>

<div id="screen-day" class="screen active">
  <h1>CanterPro Ultra</h1>
  <div class="card">
    <button onclick="show('screen-settings')">‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
  </div>
  <div class="card">
    <button onclick="startDay()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</button>
    <p id="dayInfo"></p>
  </div>
</div>

<div id="screen-settings" class="screen">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  <div class="card">
    <label>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</label>
    <textarea id="payDetails" rows="5"></textarea>

    <label>–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º</label>
    <select id="timeMultiplier">
      <option value="1">–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è</option>
      <option value="10">x10 (1 –º–∏–Ω = 10 –º–∏–Ω)</option>
      <option value="30">x30</option>
      <option value="60">x60</option>
    </select>

    <button onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="gray" onclick="show('screen-day')">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
</div>

<div id="screen-type" class="screen">
  <h2>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
  <div class="card">
    <button onclick="openOrder()">–î–æ –±–∞–∑—ã ‚Ä¢ 5+1</button>
  </div>
</div>

<div id="screen-order" class="screen">
  <h2>–ó–∞–∫–∞–∑ ‚Ä¢ 5+1</h2>
  <div class="card">
    <input id="rate" type="number" placeholder="–°—Ç–∞–≤–∫–∞ ‚ÇΩ/—á–∞—Å">
    <button onclick="startOrder()">‚ñ∂ –ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="timerBlock" class="card" style="display:none;">
    <div id="timer" class="timer">00:00:00</div>
    <button class="red" onclick="finishOrder()">‚èπ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="resultBlock" class="card" style="display:none;">
    <pre id="report"></pre>
    <input id="photos" type="file" accept="image/*" multiple>
    <button class="gray" onclick="shareReport()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
    <button onclick="newOrder()">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
  </div>
</div>

<script>
let multiplier = Number(localStorage.getItem('multiplier') || 1);
document.getElementById('timeMultiplier').value = multiplier;
document.getElementById('payDetails').value = localStorage.getItem('payDetails')||'';

function saveSettings(){
  multiplier = Number(document.getElementById('timeMultiplier').value);
  localStorage.setItem('multiplier', multiplier);
  localStorage.setItem('payDetails', document.getElementById('payDetails').value);
  alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
  show('screen-day');
}

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startDay(){
  document.getElementById('dayInfo').textContent='–ù–∞—á–∞—Ç–æ: '+new Date().toLocaleTimeString();
  show('screen-type');
}

function openOrder(){ show('screen-order'); }

let realStart=null, interval=null, lastReport='';

function startOrder(){
  if(!rate.value) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É');
  realStart=Date.now();
  timerBlock.style.display='block';
  resultBlock.style.display='none';
  interval=setInterval(updateTimer,1000);
}

function updateTimer(){
  const realDiff=Date.now()-realStart;
  const testDiff=realDiff*multiplier;
  const sec=Math.floor(testDiff/1000);
  timer.textContent=
    String(Math.floor(sec/3600)).padStart(2,'0')+':' +
    String(Math.floor(sec%3600/60)).padStart(2,'0')+':' +
    String(sec%60).padStart(2,'0');
}

function finishOrder(){
  clearInterval(interval);
  const rateVal=Number(rate.value);
  const realEnd=new Date();
  const testMinutes=Math.ceil((realEnd-realStart)*multiplier/60000);

  let paid=6, roundTxt='';
  if(testMinutes>360){
    const extra=testMinutes-360;
    let extraH=Math.floor(extra/60);
    if(extra%60>15) extraH++;
    paid+=extraH;
    if(extra%60>15){
      roundTxt=` (–æ–∫—Ä—É–≥–ª–µ–Ω–æ –¥–æ ${String(realEnd.getHours()+1).padStart(2,'0')}:00)`;
    }
  }

  lastReport=
`–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
–°—Ö–µ–º–∞: 5+1
–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${realEnd.toLocaleTimeString().slice(0,5)}${roundTxt}
–ö –æ–ø–ª–∞—Ç–µ –∑–∞: ${paid} —á
–°—Ç–∞–≤–∫–∞: ${rateVal} ‚ÇΩ/—á
–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${paid*rateVal} ‚ÇΩ

–†–µ–∫–≤–∏–∑–∏—Ç—ã:
${localStorage.getItem('payDetails')||'‚Äî'}`;

  report.textContent=lastReport;
  resultBlock.style.display='block';
}

async function shareReport(){
  const files=photos.files.length?[...photos.files]:undefined;
  await navigator.share({text:lastReport,files});
}

function newOrder(){
  timerBlock.style.display='none';
  resultBlock.style.display='none';
  rate.value='';
  photos.value='';
  show('screen-type');
}
</script>

</body>
  </html>
