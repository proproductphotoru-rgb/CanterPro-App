<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DriverShift PWA</title>

<link rel="manifest" href="manifest.json">

<style>
body { margin:0; font-family:system-ui; background:#f4f6f8; }
header { background:#1976d2; color:#fff; padding:14px; text-align:center; font-size:18px; }
.hidden { display:none }
.container { padding:16px }
button { width:100%; padding:14px; border:none; border-radius:14px; font-size:16px; font-weight:600 }
.primary { background:#1976d2; color:#fff }
.secondary { background:#e0e0e0 }
.danger { background:#d32f2f; color:#fff }
.card { background:#fff; border-radius:16px; padding:16px; margin-bottom:12px; box-shadow:0 2px 8px rgba(0,0,0,.08) }
.tabs { display:flex; gap:8px; margin-bottom:12px }
.tab { flex:1; padding:10px; text-align:center; border-radius:12px; font-weight:600; background:#ddd }
.tab.active { background:#1976d2; color:#fff }
.side { position:fixed; right:8px; top:120px; display:flex; flex-direction:column; gap:8px }
.side button { width:52px; height:52px; border-radius:14px }
.calc-btn { position:fixed; bottom:20px; right:20px; width:64px; height:64px; border-radius:50%; font-size:24px }
input, select { width:100%; padding:10px; border-radius:10px; border:1px solid #ccc; margin-top:6px }
label { font-weight:600 }
hr { border:none; border-top:1px solid #ddd; margin:12px 0 }
</style>
</head>

<body>

<header>DriverShift</header>

<div class="container">

<!-- MAIN -->
<div id="mainScreen">
  <div class="card">
    <button class="primary" onclick="startShift()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á—É—é —Å–º–µ–Ω—É</button>
  </div>
  <div class="card">
    <button class="secondary" onclick="openReports()">–û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
  </div>
</div>

<!-- SHIFT -->
<div id="shiftScreen" class="hidden">

  <div class="tabs">
    <div class="tab active" onclick="openTab('shift')">–°–º–µ–Ω–∞</div>
    <div class="tab" onclick="openTab('orders')">–ó–∞–∫–∞–∑—ã</div>
    <div class="tab" onclick="openTab('expenses')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</div>
  </div>

  <div id="tab-shift">
    <div class="card">
      <h3>–†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞</h3>
      <div id="shiftInfo"></div>
      <button class="danger" onclick="endShift()">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É</button>
    </div>
  </div>

  <div id="tab-orders" class="hidden">
    <div class="card">
      <h3>–ó–∞–∫–∞–∑—ã</h3>
      <button onclick="newOrder('5+1')">5+1</button><br><br>
      <button onclick="newOrder('km')">–ó–∞ –∫–º</button><br><br>
      <button onclick="newOrder('fix')">–§–∏–∫—Å</button><br><br>
      <button onclick="newOrder('fix_kad')">–§–∏–∫—Å + –ö–ê–î</button>
    </div>
    <div id="ordersList"></div>
  </div>

  <div id="tab-expenses" class="hidden">
    <div class="card">
      <h3>–†–∞—Å—Ö–æ–¥—ã</h3>
      <label>–°—É–º–º–∞</label>
      <input id="expSum" type="number">
      <button onclick="addExpense()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>

</div>

<!-- REPORTS -->
<div id="reportsScreen" class="hidden">
  <div class="card">
    <button onclick="goHome()">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
  </div>
  <div id="reportsList"></div>
</div>

<!-- CALCULATOR -->
<div id="calcModal" class="hidden">
  <div class="card">
    <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h3>

    <label>–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂</label>
    <input id="calcKm" type="number">

    <label>–°—Ç–∞–≤–∫–∞ ‚ÇΩ/–∫–º</label>
    <input id="calcRate" type="number" value="70">

    <label><input type="checkbox" id="calcRef"> –†–µ—Ñ—Ä–∏–∂–µ—Ä–∞—Ç–æ—Ä</label><br>
    <label><input type="checkbox" id="calcWeb"> –í–µ–±–∞—Å—Ç–æ</label>

    <hr>
    <button onclick="calc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="calcResult"></div>

    <button onclick="closeCalc()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<button class="primary calc-btn" onclick="openCalc()">üßÆ</button>

</div>

<script>
let data = JSON.parse(localStorage.getItem("app")) || {
  shift:null, orders:[], expenses:[]
};

function save(){ localStorage.setItem("app", JSON.stringify(data)); }

function startShift(){
  if(data.shift && !data.shift.closed){ alert("–°–º–µ–Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞"); return; }
  data.shift={ start:Date.now(), closed:false };
  save(); render();
}

function endShift(){
  if(data.orders.some(o=>!o.closed)){ alert("–ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑"); return; }
  data.shift.closed=true;
  save(); goHome();
}

function newOrder(type){
  data.orders.push({ type, start:Date.now(), closed:false });
  save(); render();
}

function openTab(t){
  document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
  event.target.classList.add("active");
  ["shift","orders","expenses"].forEach(id=>{
    document.getElementById("tab-"+id).classList.add("hidden");
  });
  document.getElementById("tab-"+t).classList.remove("hidden");
}

function openCalc(){ document.getElementById("calcModal").classList.remove("hidden"); }
function closeCalc(){ document.getElementById("calcModal").classList.add("hidden"); }

function calc(){
  let km=+calcKm.value;
  let rate=+calcRate.value;
  let fuel=km*0.12*76.04;
  let income=km*rate;
  if(calcRef.checked) fuel*=1.2;
  let tax=income*0.06;
  let amort=income*0.2;
  let clean=income-fuel-tax-amort;
  calcResult.innerHTML=`–î–æ—Ö–æ–¥: ${income.toFixed(0)}<br>–†–∞—Å—Ö–æ–¥: ${fuel.toFixed(0)}<br>–ß–∏—Å—Ç—ã–π: ${clean.toFixed(0)}`;
}

function render(){
  mainScreen.classList.toggle("hidden", !!data.shift && !data.shift.closed);
  shiftScreen.classList.toggle("hidden", !data.shift || data.shift.closed);
  if(data.shift){
    shiftInfo.innerHTML=`–ù–∞—á–∞–ª–æ: ${new Date(data.shift.start).toLocaleString()}`;
  }
}

function goHome(){
  mainScreen.classList.remove("hidden");
  shiftScreen.classList.add("hidden");
  reportsScreen.classList.add("hidden");
}

function openReports(){
  mainScreen.classList.add("hidden");
  reportsScreen.classList.remove("hidden");
}

render();
</script>

</body>
</html>
