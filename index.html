<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>CanterPro Ultra</title>

<style>
body { margin:0;font-family:Arial;background:#f2f2f2; }
nav { display:flex;background:#1976d2;color:#fff; }
nav button { flex:1;background:none;border:none;color:#fff;padding:14px; }
.screen { display:none;padding:16px; }
.screen.active { display:block; }
.card { background:#fff;padding:16px;border-radius:10px;margin-bottom:16px; }
input, textarea { width:100%;padding:12px;margin-top:8px;font-size:16px; }
button.main { width:100%;padding:14px;background:#1976d2;color:#fff;
  border:none;border-radius:8px;margin-top:12px; }
table { width:100%;border-collapse:collapse;font-size:14px; }
td,th { border-bottom:1px solid #ddd;padding:6px; }
</style>
</head>

<body>

<nav>
  <button onclick="show('order')">–ó–∞–∫–∞–∑</button>
  <button onclick="show('fuel')">–ó–∞–ø—Ä–∞–≤–∫–∞</button>
  <button onclick="show('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<!-- –ó–ê–ö–ê–ó -->
<div id="order" class="screen active">
  <h2>–ó–∞–∫–∞–∑</h2>

  <div class="card">
    <label>–°—Ç–∞–≤–∫–∞ ‚ÇΩ / —á–∞—Å</label>
    <input id="rate" type="number">
    <button class="main" onclick="startOrder()">–ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="orderActive" class="card" style="display:none;">
    <p>–ó–∞–∫–∞–∑ –≤ —Ä–∞–±–æ—Ç–µ</p>
    <button class="main" onclick="finishOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="orderReport" class="card" style="display:none;">
    <pre id="report"></pre>
  </div>
</div>

<!-- –ó–ê–ü–†–ê–í–ö–ê -->
<div id="fuel" class="screen">
  <h2>–ó–∞–ø—Ä–∞–≤–∫–∞</h2>

  <div class="card">
    <label>
      <input type="checkbox" id="isWebasto"> –í–µ–±–∞—Å—Ç–æ
    </label>

    <label>–õ–∏—Ç—Ä—ã</label>
    <input id="fuelLiters" type="number">

    <label>–¶–µ–Ω–∞ –∑–∞ –ª–∏—Ç—Ä ‚ÇΩ</label>
    <input id="fuelPrice" type="number">

    <button class="main" onclick="addFuel()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <div class="card">
    <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
    <table id="fuelTable"></table>
  </div>
</div>

<!-- –ù–ê–°–¢–†–û–ô–ö–ò -->
<div id="settings" class="screen">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

  <div class="card">
    <label>–†–∞—Å—Ö–æ–¥ –≤–µ–±–∞—Å—Ç–æ (–ª / —á–∞—Å)</label>
    <input id="webastoRate" type="number" step="0.1">
    <button class="main" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
let fuels = JSON.parse(localStorage.getItem('fuels') || '[]');
let settings = JSON.parse(localStorage.getItem('settings') || '{"webastoRate":0.4}');
let orderStart = null;

webastoRate.value = settings.webastoRate;

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function saveSettings(){
  settings.webastoRate = Number(webastoRate.value);
  localStorage.setItem('settings', JSON.stringify(settings));
  alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ');
}

function startOrder(){
  orderStart = Date.now();
  document.getElementById('orderActive').style.display='block';
}

function finishOrder(){
  const end = Date.now();
  const hours = Math.ceil((end - orderStart) / 3600000);

  // —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –≤–µ–±–∞—Å—Ç–æ
  const webastoFuels = fuels.filter(f=>f.isWebasto);
  const avgPrice = webastoFuels.reduce((s,f)=>s+f.sum,0) /
                   webastoFuels.reduce((s,f)=>s+f.liters,0) || 0;

  const webastoLiters = hours * settings.webastoRate;
  const webastoCost = webastoLiters * avgPrice;

  report.textContent =
`–ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à—ë–Ω
–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${hours} —á

üî• –í–µ–±–∞—Å—Ç–æ
–†–∞—Å—Ö–æ–¥: ${settings.webastoRate} –ª/—á
–¢–æ–ø–ª–∏–≤–æ: ${webastoLiters.toFixed(2)} –ª
–°—É–º–º–∞: ${webastoCost.toFixed(0)} ‚ÇΩ`;

  document.getElementById('orderReport').style.display='block';
}

function addFuel(){
  fuels.push({
    date:new Date().toISOString(),
    liters:Number(fuelLiters.value),
    price:Number(fuelPrice.value),
    sum:fuelLiters.value*fuelPrice.value,
    isWebasto:isWebasto.checked
  });
  localStorage.setItem('fuels', JSON.stringify(fuels));
  fuelLiters.value=''; fuelPrice.value='';
  renderFuel();
}

function renderFuel(){
  fuelTable.innerHTML='<tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>‚ÇΩ</th></tr>';
  fuels.slice().reverse().forEach(f=>{
    fuelTable.innerHTML+=`
      <tr>
        <td>${new Date(f.date).toLocaleDateString()}</td>
        <td>${f.isWebasto?'–í–µ–±–∞—Å—Ç–æ':'–¢–æ–ø–ª–∏–≤–æ'}</td>
        <td>${f.sum.toFixed(0)}</td>
      </tr>`;
  });
}
renderFuel();
</script>

</body>
</html>
