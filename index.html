<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CanterPro</title>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background:#f4f6f8;
}
header {
  background:#1976d2;
  color:#fff;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:600;
}
.hidden { display:none }
.container { padding:16px }
button {
  width:100%;
  padding:16px;
  border:none;
  border-radius:30px;
  font-size:18px;
  font-weight:600;
  margin-bottom:12px;
}
.primary { background:#1976d2; color:#fff }
.secondary { background:#e0e0e0 }
.danger { background:#d32f2f; color:#fff }

.card {
  background:#fff;
  border-radius:18px;
  padding:16px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}

.tabs {
  display:flex;
  gap:8px;
  margin-bottom:12px;
}
.tab {
  flex:1;
  padding:12px;
  border-radius:16px;
  text-align:center;
  font-weight:600;
  color:#fff;
}
.tab.active { opacity:1 }
.tab.inactive { opacity:.5 }
.tab.shift { background:#2196f3 }
.tab.orders { background:#4caf50 }
.tab.exp { background:#ff9800 }

.side {
  position:fixed;
  right:8px;
  top:120px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.side button {
  width:56px;
  height:56px;
  border-radius:14px;
  font-size:20px;
  padding:0;
}

.calc-btn {
  position:fixed;
  left:8px;
  bottom:8px;
  background:#673ab7;
  color:#fff;
  width:56px;
  height:56px;
  border-radius:50%;
  font-size:22px;
}
.red {
  color:#d32f2f;
  font-weight:700;
}
.small { font-size:14px; color:#555 }
</style>
</head>

<body>

<header>CanterPro</header>

<!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
<div id="screenStart" class="container">
  <button class="primary" onclick="startShift()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á—É—é —Å–º–µ–Ω—É</button>
  <button class="secondary" onclick="openReports()">–û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
</div>

<!-- –†–ê–ë–û–ß–ê–Ø –°–ú–ï–ù–ê -->
<div id="screenShift" class="container hidden">

  <div class="tabs">
    <div class="tab shift active" onclick="openTab('shift')">–†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞</div>
    <div class="tab orders inactive" onclick="openTab('orders')">–ó–∞–∫–∞–∑—ã</div>
    <div class="tab exp inactive" onclick="openTab('exp')">–†–∞—Å—Ö–æ–¥–Ω–∏–∫–∏</div>
  </div>

  <!-- –°–ú–ï–ù–ê -->
  <div id="tab-shift">
    <div class="card">
      <button class="danger" onclick="endShift()">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É</button>
      <div id="shiftInfo"></div>
    </div>

    <div class="card">
      <h3>–ò—Ç–æ–≥–∏ —Å–º–µ–Ω—ã</h3>
      <div id="shiftTotals"></div>
    </div>
  </div>

  <!-- –ó–ê–ö–ê–ó–´ -->
  <div id="tab-orders" class="hidden">
    <div class="card">
      <h3>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
      <button onclick="newOrder('5+1')">5 + 1</button>
      <button onclick="newOrder('km')">–ó–∞ –∫–º</button>
      <button onclick="newOrder('fixkm')">–§–∏–∫—Å + –∫–º</button>
      <button onclick="newOrder('fix')">–§–∏–∫—Å</button>
    </div>

    <div class="card">
      <h3>–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑</h3>
      <div id="activeOrder"></div>
    </div>
  </div>

  <!-- –†–ê–°–•–û–î–´ -->
  <div id="tab-exp" class="hidden">
    <div class="card">
      <h3>–†–∞—Å—Ö–æ–¥—ã –∑–∞ —Å–º–µ–Ω—É</h3>
      <p>–¢–æ–ø–ª–∏–≤–æ, –≤–µ–±–∞—Å—Ç–æ, –º–∞—Å–ª–∞ ‚Äî —Å–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø</p>
    </div>
  </div>

</div>

<!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† -->
<div id="screenCalc" class="container hidden">
  <div class="card">
    <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞</h3>

    <label>–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂</label>
    <input id="calcKm" type="number" style="width:100%;padding:10px">

    <label>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏ (—á)</label>
    <input id="calcTime" type="number" style="width:100%;padding:10px">

    <label><input type="checkbox" id="calcRef"> –†–µ—Ñ—Ä–∏–∂–µ—Ä–∞—Ç–æ—Ä (+20%)</label><br>
    <label><input type="checkbox" id="calcWeb"> –í–µ–±–∞—Å—Ç–æ</label>

    <button class="primary" onclick="calc()">–ü–æ—Å—á–∏—Ç–∞—Ç—å</button>
    <div id="calcResult"></div>
  </div>

  <button class="secondary" onclick="back()">–ù–∞–∑–∞–¥</button>
</div>

<button class="calc-btn" onclick="openCalc()">üßÆ</button>

<script>
let shift = JSON.parse(localStorage.getItem('shift'));
let orders = JSON.parse(localStorage.getItem('orders')) || [];
let activeOrder = null;

const FUEL_PRICE = 76.04;
const —Ä–∞—Å—Ö–æ–¥ = 12; // –ª / 100–∫–º

function save() {
  localStorage.setItem('shift', JSON.stringify(shift));
  localStorage.setItem('orders', JSON.stringify(orders));
}

function startShift() {
  if (shift && shift.active) {
    alert("–°–º–µ–Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–∞");
    return;
  }
  shift = {
    start: new Date().toISOString(),
    active:true
  };
  orders = [];
  save();
  render();
}

function endShift() {
  if (activeOrder) {
    alert("–ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É —Å –∞–∫—Ç–∏–≤–Ω—ã–º –∑–∞–∫–∞–∑–æ–º");
    return;
  }
  shift.active = false;
  save();
  render();
}

function newOrder(type) {
  if (activeOrder) {
    alert("–ó–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑");
    return;
  }
  activeOrder = {
    type,
    start: new Date().toISOString(),
    income:0
  };
  render();
}

function finishOrder() {
  activeOrder.end = new Date().toISOString();
  orders.push(activeOrder);
  activeOrder = null;
  save();
  render();
}

function render() {
  screenStart.classList.toggle('hidden', shift && shift.active);
  screenShift.classList.toggle('hidden', !(shift && shift.active));
  screenCalc.classList.add('hidden');

  if (shift && shift.active) {
    shiftInfo.innerHTML = `
      <p>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: ${new Date(shift.start).toLocaleDateString()}</p>
      <p>–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞: ${new Date(shift.start).toLocaleTimeString()}</p>
    `;
    let total = orders.reduce((s,o)=>s+o.income,0);
    shiftTotals.innerHTML = `
      <p>–ó–∞–∫–∞–∑–æ–≤: ${orders.length}</p>
      <p><b>–î–æ—Ö–æ–¥ –≤–∞–ª–æ–≤—ã–π:</b> ${total.toFixed(0)} ‚ÇΩ</p>
    `;
  }

  activeOrder
    ? activeOrderEl()
    : activeOrderDiv("–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞");
}

function activeOrderEl() {
  activeOrderDiv(`
    –¢–∏–ø: ${activeOrder.type}<br>
    –ù–∞—á–∞—Ç: ${new Date(activeOrder.start).toLocaleTimeString()}<br>
    <button onclick="finishOrder()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <p class="red">–ü–†–† –≤–æ–¥–∏—Ç–µ–ª—å –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç</p>
  `);
}

function activeOrderDiv(html) {
  document.getElementById("activeOrder").innerHTML = html;
}

function openTab(name) {
  ['shift','orders','exp'].forEach(t=>{
    document.getElementById('tab-'+t).classList.add('hidden');
  });
  document.getElementById('tab-'+name).classList.remove('hidden');
}

function openCalc() {
  screenStart.classList.add('hidden');
  screenShift.classList.add('hidden');
  screenCalc.classList.remove('hidden');
}

function back() {
  render();
}

function calc() {
  let km = +calcKm.value;
  let fuel = km * —Ä–∞—Å—Ö–æ–¥ / 100;
  let cost = fuel * FUEL_PRICE;
  let coef = calcRef.checked ? 1.2 : 1;
  let result = cost * coef;

  calcResult.innerHTML = `
    <p>–¢–æ–ø–ª–∏–≤–æ: ${fuel.toFixed(1)} –ª</p>
    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: ${result.toFixed(0)} ‚ÇΩ</p>
    <p class="small">–ë–µ–∑ —É—á—ë—Ç–∞ –º–∞—Ä–∂–∏, –Ω–∞–ª–æ–≥–æ–≤ –∏ –∞–º–æ—Ä—Ç–∏–∑–∞—Ü–∏–∏</p>
  `;
}

render();
</script>

</body>
</html>
