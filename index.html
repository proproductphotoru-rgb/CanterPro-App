<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Driver Assistant</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111"/>
<style>
body{margin:0;font-family:Arial;background:#111;color:#eee}
header,footer{padding:10px;background:#1c1c1c;display:flex;gap:10px}
button{padding:10px 14px;border:0;border-radius:8px;background:#2e2e2e;color:#fff}
button.primary{background:#4caf50}
button.warn{background:#e53935}
button.blue{background:#1e88e5}
.screen{display:none;padding:15px}
.screen.active{display:block}
.card{background:#1e1e1e;padding:12px;border-radius:10px;margin-bottom:10px}
input,select{width:100%;padding:8px;margin:5px 0;background:#2a2a2a;color:#fff;border:0;border-radius:6px}
.bad{color:#f44336;font-weight:bold}
.good{color:#4caf50}
.mid{color:#ffb300}
.small{font-size:13px;color:#aaa}
</style>
</head>

<body>

<header>
  <button onclick="show('home')">üè†</button>
  <button onclick="show('calculator')" class="blue">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</button>
</header>

<!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
<div id="home" class="screen active">
  <div class="card">
    <button class="primary" onclick="startShift()">‚ñ∂ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á—É—é —Å–º–µ–Ω—É</button>
  </div>
  <div class="card">
    <button onclick="show('reports')">üìä –û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
  </div>
</div>

<!-- –°–ú–ï–ù–ê -->
<div id="shift" class="screen">
  <h3>–†–∞–±–æ—á–∞—è —Å–º–µ–Ω–∞</h3>
  <div class="card" id="shiftStats"></div>
  <button onclick="show('orders')">üì¶ –ó–∞–∫–∞–∑—ã</button>
  <button class="warn" onclick="endShift()">‚õî –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–º–µ–Ω—É</button>
</div>

<!-- –ó–ê–ö–ê–ó–´ -->
<div id="orders" class="screen">
  <h3>–ó–∞–∫–∞–∑—ã</h3>
  <div id="ordersList"></div>
  <button class="primary" onclick="addOrder()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>

<!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† -->
<div id="calculator" class="screen">
  <h3>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–∞</h3>

  <label>–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂</label>
  <input id="calcKm" type="number">

  <label>–í—Ä–µ–º—è –≤ –ø—É—Ç–∏ (—á–∞—Å—ã)</label>
  <input id="calcTime" type="number">

  <label><input type="checkbox" id="calcLO"> –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å</label>
  <label><input type="checkbox" id="calcRef"> ‚ùÑ –†–µ—Ñ—Ä–∏–∂–µ—Ä–∞—Ç–æ—Ä</label>
  <label><input type="checkbox" id="calcWeb"> üî• –í–µ–±–∞—Å—Ç–æ</label>

  <label>–¢–æ—á–µ–∫</label>
  <input id="calcPoints" type="number" value="1">

  <button class="primary" onclick="calc()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

  <div id="calcResult" class="card"></div>
</div>

<!-- –û–¢–ß–Å–¢–´ -->
<div id="reports" class="screen">
  <h3>–û—Ç—á—ë—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h3>
  <div class="card" id="reportData"></div>
</div>

<footer class="small">
  ‚ùå –ü–†–† –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç
</footer>

<script>
let state={
  shift:null,
  orders:[],
  fuelPrice:76.04
}

function show(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'))
  document.getElementById(id).classList.add('active')
}

function startShift(){
  if(state.shift) return
  state.shift={start:Date.now(),income:0,km:0}
  updateShift()
  show('shift')
}

function endShift(){
  if(state.orders.some(o=>!o.done)) return alert("–ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑")
  state.shift=null
  show('home')
}

function updateShift(){
  let h=(Date.now()-state.shift.start)/3600000
  document.getElementById('shiftStats').innerHTML=`
    –í—Ä–µ–º—è: ${h.toFixed(1)} —á<br>
    –î–æ—Ö–æ–¥ –≤–∞–ª–æ–≤—ã–π: ${state.shift.income} ‚ÇΩ
  `
}

function addOrder(){
  if(state.orders.some(o=>!o.done)) return alert("–¢–æ–ª—å–∫–æ 1 –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–∫–∞–∑")
  let sum=prompt("–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞?")
  if(!sum) return
  state.orders.push({sum:+sum,done:false})
  state.shift.income+=+sum
  renderOrders()
}

function renderOrders(){
  let el=document.getElementById('ordersList')
  el.innerHTML=""
  state.orders.forEach((o,i)=>{
    let d=document.createElement('div')
    d.className='card'
    d.innerHTML=`
      –ó–∞–∫–∞–∑ #${i+1}<br>
      –°—É–º–º–∞: ${o.sum} ‚ÇΩ<br>
      –°—Ç–∞—Ç—É—Å: ${o.done?"‚úÖ":"‚è≥"}
      <br><button onclick="closeOrder(${i})">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    `
    el.appendChild(d)
  })
}

function closeOrder(i){
  state.orders[i].done=true
  renderOrders()
}

function calc(){
  let km=+calcKm.value
  let t=+calcTime.value
  let lo=calcLO.checked
  let ref=calcRef.checked
  let web=calcWeb.checked

  let fuel=km*0.35*state.fuelPrice
  if(ref) fuel*=1.18
  if(web) fuel+=t*0.5*state.fuelPrice

  let rate=[60,70,80]
  let res=""
  rate.forEach(r=>{
    let income=km*r
    let clean=income-fuel-income*0.26
    let cls=clean<0?"bad":clean<5000?"mid":"good"
    res+=`<div class="${cls}">
      ${r} ‚ÇΩ/–∫–º ‚Üí ${income.toFixed(0)} ‚ÇΩ |
      —á–∏—Å—Ç—ã–º–∏ ‚âà ${clean.toFixed(0)} ‚ÇΩ
    </div>`
  })

  document.getElementById('calcResult').innerHTML=res
}

if('serviceWorker'in navigator){
  navigator.serviceWorker.register('sw.js')
}
</script>
</body>
</html>
