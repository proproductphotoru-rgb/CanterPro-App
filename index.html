<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<title>CanterPro Ultra</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

header {
  background: #1976d2;
  color: #fff;
  padding: 16px;
  text-align: center;
  font-size: 18px;
}

nav {
  display: flex;
  background: #1976d2;
}

nav button {
  flex: 1;
  border: none;
  background: none;
  color: #fff;
  padding: 14px;
}

.screen {
  display: none;
  padding: 16px;
}

.screen.active {
  display: block;
}

.card {
  background: #fff;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
}

.card h3 {
  margin-top: 0;
}

button.main {
  width: 100%;
  padding: 14px;
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 10px;
  margin-top: 12px;
  font-size: 16px;
}

button.red {
  background: #c62828;
}

button.gray {
  background: #555;
}

input, textarea {
  width: 100%;
  padding: 14px;
  margin-top: 8px;
  font-size: 16px;
  box-sizing: border-box;
}

.timer {
  font-size: 32px;
  text-align: center;
  margin: 10px 0;
}

pre {
  background: #eee;
  padding: 12px;
  white-space: pre-wrap;
  border-radius: 8px;
}

.hidden {
  display: none;
}

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

td, th {
  border-bottom: 1px solid #ddd;
  padding: 6px;
}
</style>
</head>

<body>

<header>CanterPro Ultra</header>

<nav>
  <button onclick="show('day')">–î–µ–Ω—å</button>
  <button onclick="show('order')">–ó–∞–∫–∞–∑</button>
  <button onclick="show('fuel')">–ó–∞–ø—Ä–∞–≤–∫–∞</button>
  <button onclick="show('settings')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<!-- ================= –†–ê–ë–û–ß–ò–ô –î–ï–ù–¨ ================= -->
<div id="day" class="screen active">
  <div class="card">
    <h3>–†–∞–±–æ—á–∏–π –¥–µ–Ω—å</h3>
    <p id="dayInfo">–î–µ–Ω—å –Ω–µ –Ω–∞—á–∞—Ç</p>
    <button class="main" onclick="startDay()">‚ñ∂ –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</button>
  </div>
</div>

<!-- ================= –ó–ê–ö–ê–ó ================= -->
<div id="order" class="screen">
  <h2>–ó–∞–∫–∞–∑ ‚Ä¢ 5+1</h2>

  <div id="orderLock" class="card">
    <p>–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫—Ä—ã—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</p>
  </div>

  <div id="orderContent" class="hidden">

    <div id="startBlock" class="card">
      <h3>–°—Ç–∞–≤–∫–∞</h3>
      <label>‚ÇΩ / —á–∞—Å</label>
      <input id="rate" type="number">
      <button class="main" onclick="startOrder()">‚ñ∂ –ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <div id="timerBlock" class="card hidden">
      <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
      <div id="timer" class="timer">00:00:00</div>
      <button class="red" onclick="finishOrder()">‚èπ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>

    <div id="routeBlock" class="card hidden">
      <h3>–ú–∞—Ä—à—Ä—É—Ç</h3>
      <button class="main" onclick="openNavigator()">üó∫ –û—Ç–∫—Ä—ã—Ç—å –Ø–Ω–¥–µ–∫—Å –ù–∞–≤–∏–≥–∞—Ç–æ—Ä</button>
      <label>–ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂ (–∫–º)</label>
      <input id="distance" type="number">
    </div>

    <div id="resultBlock" class="card hidden">
      <h3>–û—Ç—á—ë—Ç</h3>
      <pre id="report"></pre>
      <label>–§–æ—Ç–æ –¢–¢–ù</label>
      <input id="photos" type="file" accept="image/*" multiple>
      <button class="gray" onclick="shareReport()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
      <button class="main" onclick="newOrder()">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
    </div>

  </div>
</div>

<!-- ================= –ó–ê–ü–†–ê–í–ö–ê ================= -->
<div id="fuel" class="screen">
  <h2>–ó–∞–ø—Ä–∞–≤–∫–∞</h2>

  <div id="fuelLock" class="card">
    <p>–ó–∞–ø—Ä–∞–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</p>
  </div>

  <div id="fuelContent" class="hidden">

    <div class="card">
      <label>
        <input type="checkbox" id="isWebasto"> üî• –í–µ–±–∞—Å—Ç–æ
      </label>
      <label>–õ–∏—Ç—Ä—ã</label>
      <input id="fuelLiters" type="number">
      <label>–¶–µ–Ω–∞ ‚ÇΩ / –ª</label>
      <input id="fuelPrice" type="number">
      <button class="main" onclick="addFuel()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="card">
      <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
      <p id="fuelStats"></p>
    </div>

    <div class="card">
      <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
      <table id="fuelTable"></table>
    </div>

  </div>
</div>

<!-- ================= –ù–ê–°–¢–†–û–ô–ö–ò ================= -->
<div id="settings" class="screen">
  <div class="card">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <label>–†–∞—Å—Ö–æ–¥ –≤–µ–±–∞—Å—Ç–æ (–ª / —á–∞—Å)</label>
    <input id="webastoRate" type="number" step="0.1">
    <label>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã</label>
    <textarea id="payDetails" rows="4"></textarea>
    <button class="main" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script>
let dayStarted = localStorage.getItem('dayStarted') === 'true';
let dayStartTime = localStorage.getItem('dayStartTime');

let fuels = JSON.parse(localStorage.getItem('fuels') || '[]');
let settings = JSON.parse(localStorage.getItem('settings') || '{"webastoRate":0.4}');

let orderStart = null;
let interval = null;
let lastReport = '';

webastoRate.value = settings.webastoRate;
payDetails.value = localStorage.getItem('payDetails') || '';

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startDay() {
  dayStarted = true;
  dayStartTime = new Date().toISOString();
  localStorage.setItem('dayStarted', 'true');
  localStorage.setItem('dayStartTime', dayStartTime);
  updateLocks();
}

function updateLocks() {
  if (dayStarted) {
    dayInfo.textContent = '–î–µ–Ω—å –Ω–∞—á–∞—Ç: ' + new Date(dayStartTime).toLocaleTimeString();
    orderLock.classList.add('hidden');
    orderContent.classList.remove('hidden');
    fuelLock.classList.add('hidden');
    fuelContent.classList.remove('hidden');
  }
}

function startOrder() {
  if (!rate.value) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É');
  orderStart = Date.now();
  startBlock.classList.add('hidden');
  timerBlock.classList.remove('hidden');
  routeBlock.classList.remove('hidden');
  interval = setInterval(updateTimer, 1000);
}

function updateTimer() {
  const s = Math.floor((Date.now() - orderStart) / 1000);
  timer.textContent =
    String(Math.floor(s / 3600)).padStart(2,'0') + ':' +
    String(Math.floor(s % 3600 / 60)).padStart(2,'0') + ':' +
    String(s % 60).padStart(2,'0');
}

function finishOrder() {
  clearInterval(interval);
  const end = new Date();
  const minutes = Math.ceil((end - orderStart) / 60000);

  let paidHours = 6;
  if (minutes > 360) {
    let extra = minutes - 360;
    let h = Math.floor(extra / 60);
    if (extra % 60 > 15) h++;
    paidHours += h;
  }

  lastReport =
`–ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à—ë–Ω
–°—Ö–µ–º–∞: 5+1
–û–∫–æ–Ω—á–∞–Ω–∏–µ: ${end.toLocaleTimeString().slice(0,5)}
–ö –æ–ø–ª–∞—Ç–µ –∑–∞: ${paidHours} —á
–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ: ${paidHours * rate.value} ‚ÇΩ

–†–µ–∫–≤–∏–∑–∏—Ç—ã:
${payDetails.value || '‚Äî'}`;

  report.textContent = lastReport;
  resultBlock.classList.remove('hidden');
}

function openNavigator() {
  location.href = "yandexnavi://build_route_on_map";
}

function shareReport() {
  const file = new File([lastReport], '–û—Ç—á–µ—Ç.txt', { type: 'text/plain' });
  navigator.share({ files: [file, ...photos.files] });
}

function newOrder() {
  startBlock.classList.remove('hidden');
  timerBlock.classList.add('hidden');
  routeBlock.classList.add('hidden');
  resultBlock.classList.add('hidden');
  rate.value = '';
  distance.value = '';
  photos.value = '';
}

function addFuel() {
  fuels.push({
    date: new Date().toISOString(),
    liters: Number(fuelLiters.value),
    price: Number(fuelPrice.value),
    sum: fuelLiters.value * fuelPrice.value,
    isWebasto: isWebasto.checked
  });
  localStorage.setItem('fuels', JSON.stringify(fuels));
  fuelLiters.value = '';
  fuelPrice.value = '';
  isWebasto.checked = false;
  renderFuel();
}

function renderFuel() {
  let fuelSum = 0, webastoSum = 0;
  fuels.forEach(f => {
    if (f.isWebasto) webastoSum += f.sum;
    else fuelSum += f.sum;
  });
  fuelStats.innerHTML = `
‚õΩ –¢–æ–ø–ª–∏–≤–æ: <b>${fuelSum.toFixed(0)} ‚ÇΩ</b><br>
üî• –í–µ–±–∞—Å—Ç–æ: <b>${webastoSum.toFixed(0)} ‚ÇΩ</b><br>
üí∞ –í—Å–µ–≥–æ: <b>${(fuelSum + webastoSum).toFixed(0)} ‚ÇΩ</b>`;
  fuelTable.innerHTML =
    '<tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>‚ÇΩ</th></tr>';
  fuels.slice().reverse().forEach(f => {
    fuelTable.innerHTML += `
<tr>
<td>${new Date(f.date).toLocaleDateString()}</td>
<td>${f.isWebasto ? '–í–µ–±–∞—Å—Ç–æ' : '–¢–æ–ø–ª–∏–≤–æ'}</td>
<td>${f.sum.toFixed(0)}</td>
</tr>`;
  });
}

updateLocks();
renderFuel();
</script>

</body>
      </html>
