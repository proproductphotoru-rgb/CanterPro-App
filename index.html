<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CanterPro Ultra</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f2f2f2;
}

.screen {
  display: none;
  padding: 16px;
}

.screen.active {
  display: block;
}

h1, h2, h3 {
  margin-top: 0;
}

.card {
  background: #fff;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-top: 12px;
  border: none;
  border-radius: 6px;
  background: #1976d2;
  color: white;
}

button.red {
  background: #c62828;
}

button.gray {
  background: #555;
}

input {
  width: 100%;
  padding: 12px;
  font-size: 16px;
  margin-top: 8px;
}

.timer {
  font-size: 28px;
  text-align: center;
  margin-top: 12px;
}

pre {
  background: #eee;
  padding: 12px;
  white-space: pre-wrap;
}
</style>
</head>

<body>

<!-- –≠–ö–†–ê–ù 1: –†–ê–ë–û–ß–ò–ô –î–ï–ù–¨ -->
<div id="screen-day" class="screen active">
  <h1>CanterPro Ultra</h1>
  <div class="card">
    <h2>–†–∞–±–æ—á–∏–π –¥–µ–Ω—å</h2>
    <button onclick="startDay()">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å</button>
    <p id="dayInfo"></p>
  </div>
</div>

<!-- –≠–ö–†–ê–ù 2: –í–´–ë–û–† -->
<div id="screen-type" class="screen">
  <h2>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
  <div class="card">
    <button onclick="openOrder()">–î–æ –±–∞–∑—ã ‚Ä¢ –°—Ö–µ–º–∞ 5+1</button>
  </div>
</div>

<!-- –≠–ö–†–ê–ù 3: –ó–ê–ö–ê–ó -->
<div id="screen-order" class="screen">
  <h2>–ó–∞–∫–∞–∑ ‚Ä¢ 5+1</h2>

  <div class="card">
    <label>–°—Ç–∞–≤–∫–∞ (‚ÇΩ / —á–∞—Å)</label>
    <input id="rate" type="number" placeholder="1000">
    <button onclick="startOrder()">‚ñ∂ –ù–∞—á–∞—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="timerBlock" class="card" style="display:none;">
    <h3>–ü—Ä–æ—à–ª–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
    <div id="timer" class="timer">00:00:00</div>
    <button class="red" onclick="finishOrder()">‚èπ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <div id="resultBlock" class="card" style="display:none;">
    <h3>–ö—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç</h3>
    <pre id="report"></pre>

    <label>–§–æ—Ç–æ –¢–¢–ù</label>
    <input id="photos" type="file" accept="image/*" multiple>

    <button class="gray" onclick="shareReport()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∏—Å–ø–µ—Ç—á–µ—Ä—É</button>
    <button onclick="newOrder()">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
  </div>
</div>

<script>
function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startDay() {
  const now = new Date();
  document.getElementById('dayInfo').textContent =
    '–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –Ω–∞—á–∞—Ç: ' + now.toLocaleTimeString();
  show('screen-type');
}

function openOrder() {
  show('screen-order');
}

let startTime = null;
let interval = null;
let lastReportText = '';

function startOrder() {
  const rate = document.getElementById('rate').value;
  if (!rate || rate <= 0) {
    alert('–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É');
    return;
  }

  startTime = Date.now();
  document.getElementById('timerBlock').style.display = 'block';
  document.getElementById('resultBlock').style.display = 'none';

  interval = setInterval(updateTimer, 1000);
}

function updateTimer() {
  const diff = Date.now() - startTime;
  const sec = Math.floor(diff / 1000);
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;

  document.getElementById('timer').textContent =
    String(h).padStart(2,'0') + ':' +
    String(m).padStart(2,'0') + ':' +
    String(s).padStart(2,'0');
}

function finishOrder() {
  clearInterval(interval);

  const rate = Number(document.getElementById('rate').value);
  const diff = Date.now() - startTime;
  const minutes = Math.ceil(diff / 60000);

  let hours = Math.floor(minutes / 60);
  const rest = minutes % 60;
  if (rest > 15) hours += 1;

  const paidHours = Math.max(6, hours);
  const sum = paidHours * rate;

  lastReportText =
`–ó–∞–∫–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω
–°—Ö–µ–º–∞: 5+1
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏: ${hours} —á
–û–ø–ª–∞—á–µ–Ω–æ: ${paidHours} —á
–°—Ç–∞–≤–∫–∞: ${rate} ‚ÇΩ / —á–∞—Å
–ò—Ç–æ–≥–æ: ${sum} ‚ÇΩ`;

  document.getElementById('report').textContent = lastReportText;
  document.getElementById('resultBlock').style.display = 'block';
}

async function shareReport() {
  const files = document.getElementById('photos').files;
  const shareData = {
    text: lastReportText,
    files: files.length ? Array.from(files) : undefined
  };

  if (navigator.share) {
    try {
      await navigator.share(shareData);
    } catch (e) {
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å');
    }
  } else {
    alert('–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
  }
}

function newOrder() {
  document.getElementById('timerBlock').style.display = 'none';
  document.getElementById('resultBlock').style.display = 'none';
  document.getElementById('rate').value = '';
  show('screen-type');
}
</script>

</body>
</html>
